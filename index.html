<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Gamedev Canvas Workshop</title>
        <style>
            * { padding: 0; margin: 0 }
            canvas { background: #eee; display: block; margin: 0 auto; }
        </style>
    </head>
    <body>

        <canvas id="myCanvas" height="100px" width="100px"></canvas>

        <script>
            function gameLoop() {
              window.requestAnimationFrame(gameLoop);

              mario.update();
              mario.render();
            }

            const sprite = {
              init(options) {
                this.frameIndex = 0;
                this.tickCount = 0;
                this.ticksPerFrame = options.ticksPerFrame || 0;
                this.numberOfFrames = options.numberOfFrames || 1;

                this.context = options.context;
                this.width = options.width;
                this.height = options.height;
                this.image = options.image;
                this.spriteStartX = options.spriteStartX;
                this.spriteStartY = options.spriteStartY;
                this.spriteSeparator = options.spriteSeparator;
              },
              render() {
                // Clear the canvas
                this.context.clearRect(0, 0, this.width, this.height);

                // Draw the animation
                this.context.drawImage(
                  this.image,
                  this.spriteStartX + (this.frameIndex * (this.width + this.spriteSeparator)),
                  this.spriteStartY,
                  this.width,
                  this.height,
                  0,
                  0,
                  this.width,
                  this.height
                );
              },
              update() {
                this.tickCount += 1;

                if (this.tickCount > this.ticksPerFrame) {
                  this.tickCount = 0;

                  // Check to see if the current frame index is in range
                  if (this.frameIndex < this.numberOfFrames - 1) {
                    // Go to the next frame
                    this.frameIndex += 1;
                  } else {
                    this.frameIndex = 0;
                  }
                }
              },
            };


            const canvas = document.getElementById("myCanvas");
            canvas.width = 100;
            canvas.height = 100;
            const characterSprites = new Image();
            const mario = Object.create(sprite);
            mario.init({
              context: canvas.getContext("2d"),
              width: 16,
              height: 16,
              image: characterSprites,
              numberOfFrames: 4,
              ticksPerFrame: 4,
              spriteStartX: 80,
              spriteStartY: 34,
              spriteSeparator: 1,
            });

            // Start the game loop as soon as the sprite sheet is loaded
            characterSprites.addEventListener("load", gameLoop);
            characterSprites.src = "sprites/characters.png";
        </script>
    </body>
</html>